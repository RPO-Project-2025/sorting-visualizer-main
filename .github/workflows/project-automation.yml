name: Project Management Automation

on:
  # Срабатывает при создании и изменении issues
  issues:
    types: [opened, labeled, assigned, closed]
  # Срабатывает при создании и изменении pull requests
  pull_request:
    types: [opened, labeled, assigned, closed, ready_for_review]

jobs:
  # Автоматически добавляет новые задачи в проект
  add-to-project:
    runs-on: ubuntu-latest
    steps:
      - name: Add new issues to project
        uses: actions/add-to-project@v0.5.0
        if: github.event_name == 'issues' && github.event.action == 'opened'
        with:
          # URL вашего проекта
          project-url: https://github.com/orgs/RPO-Project-2025/projects/3
          # В какую колонку добавлять новые задачи
          column-name: 'To Do'
          github-token: ${{ secrets.PROJECT_PAT }}

  # Автоматически перемещает задачи при изменении статуса
  move-on-status-change:
    runs-on: ubuntu-latest
    steps:
      - name: Move to In Progress when assigned
        uses: actions/add-to-project@v0.5.0
        if: |
          github.event_name == 'issues' && 
          github.event.action == 'assigned'
        with:
          project-url: https://github.com/orgs/RPO-Project-2025/projects/3
          column-name: 'In Progress'
          github-token: ${{ secrets.PROJECT_PAT }}
          
      - name: Move to Review when PR is ready
        uses: actions/add-to-project@v0.5.0
        if: |
          github.event_name == 'pull_request' && 
          github.event.action == 'ready_for_review'
        with:
          project-url: https://github.com/orgs/RPO-Project-2025/projects/3
          column-name: 'Review'
          github-token: ${{ secrets.PROJECT_PAT }}

      - name: Move to Done when closed
        uses: actions/add-to-project@v0.5.0
        if: |
          (github.event_name == 'issues' || github.event_name == 'pull_request') && 
          github.event.action == 'closed'
        with:
          project-url: https://github.com/orgs/RPO-Project-2025/projects/3
          column-name: 'Done'
          github-token: ${{ secrets.PROJECT_PAT }}
