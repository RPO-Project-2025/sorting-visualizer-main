name: Project Management Automation

on:
  issues:
    types: [opened, closed]
  pull_request:
    types: [opened, closed, ready_for_review]

jobs:
  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –≤ –ø—Ä–æ–µ–∫—Ç
  add-to-project:
    runs-on: ubuntu-latest
    steps:
      - name: Add new issues to project
        uses: actions/add-to-project@v0.5.0
        if: github.event_name == 'issues' && github.event.action == 'opened'
        with:
          project-url: https://github.com/orgs/RPO-Project-2025/projects/3
          column-name: 'To Do'
          github-token: ${{ secrets.PROJECT_PAT }}

  # –ü—Ä–æ—Å—Ç—ã–µ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  telegram-simple:
    runs-on: ubuntu-latest
    steps:
      - name: Send Telegram notification
        env:
          EVENT_TYPE: "${{ github.event_name }}"
          ACTION_TYPE: "${{ github.event.action }}"
        run: |
          # –§–æ—Ä–º–∏—Ä—É–µ–º –±–∞–∑–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
          MESSAGE="üéØ *RPO Project*%0A%0A"
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
          if [ "$EVENT_TYPE" = "issues" ] && [ "$ACTION_TYPE" = "opened" ]; then
            MESSAGE="${MESSAGE}üìù *–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞*%0A"
            MESSAGE="${MESSAGE}–ó–∞–≥–æ–ª–æ–≤–æ–∫: ${{ github.event.issue.title }}%0A"
            MESSAGE="${MESSAGE}–ê–≤—Ç–æ—Ä: ${{ github.event.issue.user.login }}%0A"
            MESSAGE="${MESSAGE}–°—Å—ã–ª–∫–∞: ${{ github.event.issue.html_url }}"
          elif [ "$EVENT_TYPE" = "issues" ] && [ "$ACTION_TYPE" = "closed" ]; then
            MESSAGE="${MESSAGE}‚úÖ *–ó–∞–¥–∞—á–∞ –∑–∞–∫—Ä—ã—Ç–∞*%0A"
            MESSAGE="${MESSAGE}–ó–∞–≥–æ–ª–æ–≤–æ–∫: ${{ github.event.issue.title }}%0A"
            MESSAGE="${MESSAGE}–ê–≤—Ç–æ—Ä: ${{ github.event.issue.user.login }}"
          elif [ "$EVENT_TYPE" = "pull_request" ] && [ "$ACTION_TYPE" = "opened" ]; then
            MESSAGE="${MESSAGE}üîÄ *–ù–æ–≤—ã–π PR*%0A"
            MESSAGE="${MESSAGE}–ó–∞–≥–æ–ª–æ–≤–æ–∫: ${{ github.event.pull_request.title }}%0A"
            MESSAGE="${MESSAGE}–ê–≤—Ç–æ—Ä: ${{ github.event.pull_request.user.login }}%0A"
            MESSAGE="${MESSAGE}–°—Å—ã–ª–∫–∞: ${{ github.event.pull_request.html_url }}"
          elif [ "$EVENT_TYPE" = "pull_request" ] && [ "$ACTION_TYPE" = "ready_for_review" ]; then
            MESSAGE="${MESSAGE}üëÄ *PR –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ–≤–µ—Ä–∫–µ*%0A"
            MESSAGE="${MESSAGE}–ó–∞–≥–æ–ª–æ–≤–æ–∫: ${{ github.event.pull_request.title }}%0A"
            MESSAGE="${MESSAGE}–ê–≤—Ç–æ—Ä: ${{ github.event.pull_request.user.login }}"
          else
            MESSAGE="${MESSAGE}‚ÑπÔ∏è *–°–æ–±—ã—Ç–∏–µ –≤ –ø—Ä–æ–µ–∫—Ç–µ*%0A"
            MESSAGE="${MESSAGE}–¢–∏–ø: $EVENT_TYPE%0A"
            MESSAGE="${MESSAGE}–î–µ–π—Å—Ç–≤–∏–µ: $ACTION_TYPE"
          fi
          
          echo "–û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram..."
          echo "–¢–µ–∫—Å—Ç: $MESSAGE"
          
          # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegram
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
            -d "chat_id=${{ secrets.TELEGRAM_CHAT_ID }}" \
            -d "message_thread_id=2" \
            -d "text=$MESSAGE" \
            -d "parse_mode=Markdown"
